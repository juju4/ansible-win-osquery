// {{ ansible_managed }}
// inspired from https://github.com/iadgov/Splunk-Assessment-of-Mitigation-Implementations/raw/master/SAMI_Business_Logic.xlsx
// default interval 1d=86400sec
{
  "platform": "windows",
  "queries": {
    // AE
    "win_compliance_secureboot": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecureBoot\\State\\UEFISecureBootEnabled'",
      "interval": "86400",
      "platform": "windows",
      "snapshot": true,
      "description" : "Secureboot state"
    },
    "win_compliance_fontblocking": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\MitigationOptions\\MitigationOptions_FontBlocking'",
      "interval": "86400",
      "platform": "windows",
      "snapshot": true,
      "description" : "FontBlocking state"
    },
    "win_compliance_deppolicy": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SystemStartOptions'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_mitigationoptions": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\MitigationOptions'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_moveimages": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\moveImages'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_kernelsehopenabled": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\KernelSEHOPEnabled'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_enableCertPaddingCheck": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\WinTrust\\Config\\EnableCertPaddingCheck'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_enableCertPaddingCheck_wow64": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Cryptography\\WinTrust\\Config\\EnableCertPaddingCheck'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_cwdIllegalInDllSearch": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\CWDIllegalInDllSearch'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_disabledExceptionChainValidation": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\kernel\\DisableExceptionChainValidation'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_enableLowVaAccess": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\EnableLowVaAccess'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_cfg": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\EnableCfg'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_app_executeOptions": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\executeOptions'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_app_mitigationOptions": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\MitigationOptions'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_appCompat": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_app_disabledExceptionChainValidation": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\DisableExceptionChainValidation'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    // AW
    "win_compliance_DefaultLevelMachine": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\DefaultLevel'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_DefaultLevelUser": {
      "query" : "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\DefaultLevel'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_PolicyScopeMachine": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\PolicyScope'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_PolicyScopeUser": {
      "query" : "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\PolicyScope'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_ExecutableTryMachine": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\ExecutableTry'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_ExecutableTryUser": {
      "query" : "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\ExecutableTry'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_TransparentEnabledMachine": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\TransparentEnabled'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_TransparentEnabledUser": {
      "query" : "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\TransparentEnabled'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Unrestricted": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Unrestricted_Paths": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144\\Paths'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Unrestricted_Paths_ItemData": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144\\Paths\\%\\ItemData'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Disallowed": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Disallowed_Paths": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0\\Paths'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Disallowed_Paths_ItemData": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0\\Paths\\%\\ItemData'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_SaferFlags": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\%\\%\\%\\SaferFlags'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_RuleSetEnforcementMode": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\SrpV2\\%\\EnforcementMode'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    },
    "win_compliance_Rule": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\SrpV2\\%\\%\\Value'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    }
    // HBSS
    // McAfee only...
    // extra
    "win_compliance_DeveloperMode": {
      "query" : "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModelUnlock'",
      "interval": "86400",
      "snapshot": true,
      "platform": "windows"
    }
  }
}
